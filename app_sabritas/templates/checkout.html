<!-- templates/checkout.html -->
{% extends 'base.html' %}
{% load static %}

{% block title %}Finalizar Compra - Sabritas{% endblock %}

{% block content %}
<div style="max-width: 1200px; margin: 0 auto; padding: 20px;">
    <h1 style="color: #000; font-size: 2.5rem; margin-bottom: 30px; text-align: center;">
        üõí Finalizar Compra
    </h1>
    
    {% if messages %}
    <div style="margin-bottom: 30px;">
        {% for message in messages %}
        <div style="background: {% if message.tags == 'success' %}#28a745{% else %}#dc3545{% endif %}; 
                    color: white; padding: 15px; border-radius: 10px; margin-bottom: 10px;">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 40px;">
        <!-- Columna izquierda: Formulario -->
        <div>
            <form method="post">
                {% csrf_token %}
                
                <!-- Informaci√≥n de env√≠o -->
                <div style="background: white; padding: 25px; border: 2px solid #FFD700; border-radius: 15px; margin-bottom: 30px;">
                    <h3 style="color: #000; margin-bottom: 20px; border-bottom: 2px solid #FFD700; padding-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 1.8rem;">üì¶</span> Informaci√≥n de env√≠o
                    </h3>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #000;">
                            Nombre completo *
                        </label>
                        <input type="text" 
                               name="nombre" 
                               required
                               value="{{ user.get_full_name|default:user.username }}"
                               style="width: 100%; padding: 12px; border: 2px solid #FFD700; border-radius: 10px; font-size: 1rem;">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #000;">
                            Direcci√≥n de env√≠o *
                        </label>
                        <textarea name="direccion" 
                                  rows="3" 
                                  required
                                  placeholder="Calle, n√∫mero, colonia, ciudad, estado, c√≥digo postal"
                                  style="width: 100%; padding: 12px; border: 2px solid #FFD700; border-radius: 10px; font-size: 1rem; resize: vertical;"></textarea>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #000;">
                                Email *
                            </label>
                            <input type="email" 
                                   name="email" 
                                   required
                                   value="{{ user.email }}"
                                   style="width: 100%; padding: 12px; border: 2px solid #FFD700; border-radius: 10px; font-size: 1rem;">
                        </div>
                    </div>
                </div>
                
                <!-- M√©todo de pago -->
                <div style="background: white; padding: 25px; border: 2px solid #FFD700; border-radius: 15px; margin-bottom: 30px;">
                    <h3 style="color: #000; margin-bottom: 20px; border-bottom: 2px solid #FFD700; padding-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 1.8rem;">üí≥</span> M√©todo de pago
                    </h3>
                    
                    <div style="margin-bottom: 25px;">
                        <div style="margin-bottom: 15px; padding: 15px; border: 2px solid #FFD700; border-radius: 10px; background: #FFEC8B;">
                            <input type="radio" id="tarjeta" name="metodo_pago" value="Tarjeta de cr√©dito/d√©bito" checked style="margin-right: 10px;">
                            <label for="tarjeta" style="font-weight: bold; color: #000; font-size: 1.1rem;">
                                üí≥ Tarjeta de cr√©dito/d√©bito
                            </label>
                        </div>
                        
                        <div style="margin-bottom: 15px; padding: 15px; border: 2px solid #ddd; border-radius: 10px;">
                            <input type="radio" id="paypal" name="metodo_pago" value="PayPal" style="margin-right: 10px;">
                            <label for="paypal" style="font-weight: bold; color: #000;">
                                üîµ PayPal
                            </label>
                        </div>
                        
                        <div style="padding: 15px; border: 2px solid #ddd; border-radius: 10px;">
                            <input type="radio" id="efectivo" name="metodo_pago" value="Efectivo" style="margin-right: 10px;">
                            <label for="efectivo" style="font-weight: bold; color: #000;">
                                üíµ Efectivo al recibir
                            </label>
                        </div>
                    </div>
                    
                    <!-- Informaci√≥n de tarjeta (visible solo si selecciona tarjeta) -->
                    <div id="tarjeta-info" style="margin-top: 20px;">
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #000;">
                                N√∫mero de tarjeta
                            </label>
                            <input type="text" 
                                   placeholder="1234 5678 9012 3456"
                                   style="width: 100%; padding: 12px; border: 2px solid #FFD700; border-radius: 10px; font-size: 1rem;">
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #000;">
                                    Fecha de expiraci√≥n
                                </label>
                                <input type="text" 
                                       placeholder="MM/AA"
                                       style="width: 100%; padding: 12px; border: 2px solid #FFD700; border-radius: 10px; font-size: 1rem;">
                            </div>
                            
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #000;">
                                    CVV
                                </label>
                                <input type="text" 
                                       placeholder="123"
                                       style="width: 100%; padding: 12px; border: 2px solid #FFD700; border-radius: 10px; font-size: 1rem;">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Notas adicionales -->
                    <div style="margin-top: 25px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #000;">
                            Notas adicionales (opcional)
                        </label>
                        <textarea name="notas" 
                                  rows="3"
                                  placeholder="Instrucciones especiales para la entrega..."
                                  style="width: 100%; padding: 12px; border: 2px solid #FFD700; border-radius: 10px; font-size: 1rem; resize: vertical;"></textarea>
                    </div>
                </div>
                
                <!-- T√©rminos y condiciones -->
                <div style="background: #FFEC8B; padding: 20px; border-radius: 15px; margin-bottom: 30px;">
                    <label style="display: flex; align-items: flex-start; gap: 10px; cursor: pointer;">
                        <input type="checkbox" required style="margin-top: 5px; width: 20px; height: 20px;">
                        <span style="color: #000;">
                            <strong>Acepto los t√©rminos y condiciones</strong><br>
                            Al realizar esta compra, acepto las pol√≠ticas de env√≠o, devoluci√≥n y los t√©rminos de servicio de Sabritas.
                        </span>
                    </label>
                </div>
        </div>
        
        <!-- Columna derecha: Resumen del pedido -->
        <div>
            <div style="background: white; padding: 25px; border: 2px solid #FFD700; border-radius: 15px; margin-bottom: 30px; position: sticky; top: 20px;">
                <h3 style="color: #000; margin-bottom: 20px; border-bottom: 2px solid #FFD700; padding-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 1.8rem;">üìã</span> Resumen del pedido
                </h3>
                
                <!-- Lista de productos -->
                <div style="margin-bottom: 20px; max-height: 300px; overflow-y: auto; padding-right: 10px;">
                    {% for item in items %}
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #FFEC8B;">
                        <div style="flex: 1;">
                            <strong style="color: #000; display: block; margin-bottom: 5px;">
                                {{ item.producto.nombre }}
                            </strong>
                            <small style="color: #666;">
                                {{ item.cantidad }} x ${{ item.producto.precio }}
                            </small>
                        </div>
                        <div style="font-weight: bold; color: #000;">
                            ${{ item.subtotal|floatformat:2 }}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                <!-- Totales -->
                <div style="margin-top: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px; padding: 8px 0;">
                        <span style="color: #666;">Subtotal ({{ items.count }} productos)</span>
                        <strong>${{ subtotal|floatformat:2 }}</strong>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px; padding: 8px 0;">
                        <span style="color: #666;">IVA(16%)</span>
                        <strong>${{ iva|floatformat:2 }}</strong>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px; padding: 8px 0;">
                        <span style="color: #666;">Env√≠o</span>
                        <strong style="color: #28a745;">Gratis</strong>
                    </div>
                    
                    <div style="margin: 25px 0; border-top: 2px solid #FFD700; padding-top: 20px;">
                        <div style="display: flex; justify-content: space-between; font-size: 1.3rem;">
                            <strong style="color: #000;">TOTAL</strong>
                            <strong style="color: #28a745;">${{ total|floatformat:2 }}</strong>
                        </div>
                        <small style="color: #666; display: block; text-align: right;">
                            Incluye IVA
                        </small>
                    </div>
                </div>
                
                <!-- Bot√≥n de pago -->
                <button type="submit" 
                        style="background: linear-gradient(90deg, #28a745 0%, #20c997 100%); 
                               color: white; 
                               padding: 18px; 
                               width: 100%; 
                               border: none; 
                               border-radius: 25px; 
                               font-weight: bold; 
                               font-size: 1.2rem; 
                               cursor: pointer; 
                               margin-top: 10px;
                               transition: transform 0.2s;
                               display: flex;
                               align-items: center;
                               justify-content: center;
                               gap: 10px;">
                    <span style="font-size: 1.5rem;">‚úÖ</span>
                    Confirmar y pagar ${{ total|floatformat:2 }}
                </button>
                
                <p style="text-align: center; color: #666; font-size: 0.9rem; margin-top: 15px; display: flex; align-items: center; justify-content: center; gap: 5px;">
                    <span>üîí</span> Pago 100% seguro
                </p>
            </form> <!-- Cierre del formulario -->
            
            <!-- Volver al carrito -->
            <div style="text-align: center; margin-top: 25px;">
                <a href="{% url 'carrito' %}" 
                   style="background: #666; 
                          color: white; 
                          padding: 12px 25px; 
                          border-radius: 20px; 
                          text-decoration: none; 
                          display: inline-block;
                          transition: background 0.3s;">
                    ‚Üê Regresar al carrito
                </a>
            </div>
        </div>
    </div>
</div>

<script>
// Mostrar/ocultar informaci√≥n de tarjeta
document.addEventListener('DOMContentLoaded', function() {
    const tarjetaInfo = document.getElementById('tarjeta-info');
    const tarjetaRadio = document.getElementById('tarjeta');
    const otrosRadios = document.querySelectorAll('input[name="metodo_pago"]:not(#tarjeta)');
    
    function toggleTarjetaInfo() {
        if (tarjetaRadio.checked) {
            tarjetaInfo.style.display = 'block';
        } else {
            tarjetaInfo.style.display = 'none';
        }
    }
    
    // Inicializar
    toggleTarjetaInfo();
    
    // Escuchar cambios
    tarjetaRadio.addEventListener('change', toggleTarjetaInfo);
    otrosRadios.forEach(radio => {
        radio.addEventListener('change', toggleTarjetaInfo);
    });
    
    // Animaci√≥n para el bot√≥n
    const submitBtn = document.querySelector('button[type="submit"]');
    submitBtn.addEventListener('mouseenter', function() {
        this.style.transform = 'scale(1.02)';
    });
    
    submitBtn.addEventListener('mouseleave', function() {
        this.style.transform = 'scale(1)';
    });
    
    // Validar formulario antes de enviar
    const form = document.querySelector('form');
    form.addEventListener('submit', function(e) {
        const terminos = document.querySelector('input[type="checkbox"]');
        if (!terminos.checked) {
            e.preventDefault();
            alert('Debes aceptar los t√©rminos y condiciones para continuar.');
            return false;
        }
        
        // Mostrar loading
        submitBtn.innerHTML = '<span>‚è≥</span> Procesando pago...';
        submitBtn.disabled = true;
    });
});
</script>
{% endblock %}